version: '3.8'

services:
  validator:
    image: platform-validator:latest
    ports:
      - '8080:8080'
    environment:
      - VALIDATOR_HOTKEY=${VALIDATOR_HOTKEY}
      - PLATFORM_BASE_API=${PLATFORM_BASE_API:-http://platform-api:3000}
      - DSTACK_VMM_URL=${DSTACK_VMM_URL:-http://127.0.0.1:11530}
      - VALIDATOR_CPU_CORES=${VALIDATOR_CPU_CORES:-4}
      - VALIDATOR_MEMORY_MB=${VALIDATOR_MEMORY_MB:-2048}
      - VALIDATOR_DISK_MB=${VALIDATOR_DISK_MB:-10240}
      - VALIDATOR_GPU_COUNT=${VALIDATOR_GPU_COUNT:-0}
    volumes:
      - ./config.toml:/app/config.toml:ro
      - ./data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s





